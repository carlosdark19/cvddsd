jQuery(document).ready(function(e){var n,r,s=xoo_wsc_params.isCart=="1",o=xoo_wsc_params.isCheckout=="1",i=function(e){return xoo_wsc_params.wc_ajax_url.toString().replace("%%endpoint%%",e)},a=null;class t{constructor(e){this.$modal=e,this.timeout=null}add(e,t="success",n=!0){var o,s=this.$modal.find(".xoo-wsc-notice-container");n&&s.html(""),o=t==="success"?xoo_wsc_params.html.successNotice.toString().replace("%s%",e):xoo_wsc_params.html.errorNotice.toString().replace("%s%",e),s.html(o)}showNotification(){t.showMarkupNotice();var e=this.$modal.find(".xoo-wsc-notice-container");if(!e.length||e.children().length===0)return;e.slideDown(),clearTimeout(this.timeout),this.timeout=setTimeout(function(){e.slideUp("slow",function(){})},xoo_wsc_params.notificationTime)}hideNotification(){this.$modal.find(".xoo-wsc-notice-container").hide()}static hideMarkupNotice(){t.$noticeContainer().removeClass("xoo-wsc-active")}static $noticeContainer(){return e(".xoo-wsc-markup-notices")}static showMarkupNotice(){if(r.isOpen())return;var e=t.$noticeContainer(),n=e.find(".xoo-wsc-notice-container .xoo-wsc-notices");if(!n.length||n.children().length===0)return;setTimeout(function(){e.addClass("xoo-wsc-active")},10),clearTimeout(a),a=setTimeout(function(){e.removeClass("xoo-wsc-active")},xoo_wsc_params.notificationTime)}}class c{constructor(e,n){this.$modal=e,this.container=n||"cart",this.notice=new t(this.$modal)}isOpen(){return this.$modal.hasClass("xoo-wsc-"+this.container+"-active")}eventHandlers(){e(document.body).on("wc_fragments_refreshed updated_checkout",this.onCartUpdate.bind(this))}onCartUpdate(){this.unblock(),this.notice.showNotification()}setAjaxData(t,n){var a,i={container:this.container,noticeSection:n||this.noticeSection||this.container,isCheckout:o,isCart:s};return typeof t=="object"?e.extend(i,t):(a=t,e.each(i,function(e,t){a+="&"+e+"="+t}),i=a),i}toggle(t){var n=this.$modal.add("body").add("html"),s="xoo-wsc-"+this.container+"-active";t==="show"?n.addClass(s):t==="hide"?n.removeClass(s):n.toggleClass(s),e(document.body).trigger("xoo_wsc_"+this.container+"_toggled",[t]),this.notice.hideNotification()}block(){this.$modal.addClass("xoo-wsc-loading")}unblock(){this.$modal.removeClass("xoo-wsc-loading")}refreshMyFragments(){if(xoo_wsc_params.refreshCart==="yes"&&typeof wc_cart_fragments_params!="undefined"){e(document.body).trigger("wc_fragment_refresh");return}this.block(),e.ajax({url:i("xoo_wsc_refresh_fragments"),type:"POST",context:this,data:{},success:function(e){this.updateFragments(e)},complete:function(){this.unblock()}})}updateCartCheckoutPage(){if(o){if(e("form.checkout").length===0){location.reload();return}e(document.body).trigger("update_checkout")}s&&e(document.body).trigger("wc_update_cart")}updateFragments(t){if(console.log("updated"),t.fragments&&(e(document.body).trigger("xoo_wsc_before_loading_fragments",[t]),this.block(),e.each(t.fragments,function(t,n){e(t).replaceWith(n)}),typeof wc_cart_fragments_params!="undefined"&&"sessionStorage"in window&&window.sessionStorage!==null&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(t.fragments)),localStorage.setItem(wc_cart_fragments_params.cart_hash_key,t.cart_hash),sessionStorage.setItem(wc_cart_fragments_params.cart_hash_key,t.cart_hash),t.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime())),e(document.body).trigger("wc_fragments_refreshed"),this.unblock()),xoo_wsc_params.refreshCart==="yes"&&typeof wc_cart_fragments_params!="undefined"){this.block(),e(document.body).trigger("wc_fragment_refresh");return}}}class l extends c{constructor(e){super(e,"cart"),this.refreshFragmentsOnPageLoad(),this.eventHandlers()}refreshFragmentsOnPageLoad(){setTimeout(function(){this.refreshMyFragments()}.bind(this),xoo_wsc_params.fetchDelay)}eventHandlers(){super.eventHandlers(),this.$modal.on("click",".xoo-wsc-smr-del",this.deleteIconClick.bind(this)),this.$modal.on("click",".xoo-wsch-close, .xoo-wsc-opac, .xoo-wsc-cart-close",this.closeCartOnClick.bind(this)),this.$modal.on("click",".xoo-wsc-basket",this.toggleCart.bind(this)),e(document.body).on("xoo_wsc_cart_updated",this.updateCartCheckoutPage.bind(this)),e(document.body).on("click","a.added_to_cart, .xoo-wsc-cart-trigger",this.openCart.bind(this)),e(document.body).on("added_to_cart",this.addedToCart.bind(this)),e(document.body).on("wc-blocks_added_to_cart",this.blockAddedToCart.bind(this)),xoo_wsc_params.autoOpenCart==="yes"&&xoo_wsc_params.addedToCart==="yes"&&this.openCart(),xoo_wsc_params.ajaxAddToCart==="yes"&&e(document.body).on("submit","form.cart",this.addToCartFormSubmit.bind(this)),typeof wc_cart_fragments_params=="undefined"&&e(window).on("pageshow",this.onPageShow.bind(this)),xoo_wsc_params.triggerClass&&e(document.body).on("click","."+xoo_wsc_params.triggerClass,this.openCart.bind(this)),(o||s)&&e(document.body).on("updated_shipping_method",this.refreshMyFragments.bind(this)),this.initMasonryLayout()}toggleCart(e){this.isOpen()?this.closeCartOnClick(e):this.openCart(e)}openCart(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),this.toggle("show"),t.hideMarkupNotice()}addToCartFormSubmit(t){if(n=e(t.currentTarget),n.closest(".product").hasClass("product-type-external")||n.siblings(".xoo-wsc-disable-atc").length)return;var n,i,a,r,o=t.originalEvent&&t.originalEvent.submitter?e(t.originalEvent.submitter):n.find('button[type="submit"]'),s=new FormData(n.get(0)),l=n.serializeArray(),c=!1;e.each(l,function(e,t){if((t.name==="productID"||t.name==="add-to-cart")&&t.value)return c=!0,!1}),!c&&n.attr("action")&&(i=n.attr("action").match(/add-to-cart=([0-9]+)/),a=!!i&&i[1]),o.attr("name")&&o.attr("value")&&s.append(o.attr("name"),o.attr("value")),a&&s.append("add-to-cart",a),s.append("action","xoo_wsc_add_to_cart"),r=!0,e.each(xoo_wsc_params.skipAjaxForData,function(e,t){if(s.has(e)&&(!t||s.get(e)==t))return r=!1,!1}),r&&(t.preventDefault(),this.addToCartAjax(o,s))}addToCartAjax(n,s){this.block(),n.addClass("loading"),e(document.body).trigger("adding_to_cart",[n,s]),e.ajax({url:i("xoo_wsc_add_to_cart"),type:"POST",context:this,cache:!1,contentType:!1,processData:!1,data:s,success:function(s){s.fragments?e(document.body).trigger("added_to_cart",[s.fragments,s.cart_hash,n]):s.error?(t.$noticeContainer().replaceWith(s.notice),t.showMarkupNotice()):window.location.reload()},complete:function(){this.unblock(),n.removeClass("loading").addClass("added")}})}addedToCart(e,t){this.updateFragments({fragments:t}),this.onCartUpdate();var o=this;xoo_wsc_params.autoOpenCart==="yes"&&setTimeout(function(){o.openCart()},20)}blockAddedToCart(){e(document.body).trigger("wc_fragment_refresh"),this.block();var t=this;xoo_wsc_params.autoOpenCart==="yes"&&setTimeout(function(){t.openCart()},20)}closeCartOnClick(e){e.preventDefault(),this.toggle("hide")}onPageShow(t){t.originalEvent.persisted&&(this.refreshMyFragments(),e(document.body).trigger("wc_fragment_refresh"))}deleteIconClick(t){this.updateItemQty(e(t.currentTarget).parents(".xoo-wsc-product").data("key"),0)}updateItemQty(t,n){if(!t||n===void 0)return;this.block();var s={cart_key:t,qty:n};e.ajax({url:i("xoo_wsc_update_item_quantity"),type:"POST",context:this,data:this.setAjaxData(s),success:function(t){this.updateFragments(t),e(document.body).trigger("xoo_wsc_quantity_updated",[t]),e(document.body).trigger("xoo_wsc_cart_updated",[t]),this.unblock()}})}onCartUpdate(){super.onCartUpdate(),this.showBasket(),this.initMasonryLayout()}initMasonryLayout(){if(xoo_wsc_params.productLayout!=="cards")return;e(".xoo-wsc-products.xoo-wsc-pattern-card").masonry({itemSelector:".xoo-wsc-product-cont",columnWidth:".xoo-wsc-product-cont",percentPosition:!0})}showBasket(){var t=e(".xoo-wsc-basket"),n=xoo_wsc_params.showBasket;n==="always_show"?t.show():n==="hide_empty"?this.$modal.find(".xoo-wsc-product").length?t.show():t.hide():t.hide()}}r=new l(e(".xoo-wsc-modal")),n={type:xoo_wsc_params.cardAnimate.type,duration:xoo_wsc_params.cardAnimate.duration,init:function(){var t=xoo_wsc_params.cardAnimate.event==="back_hover"?"mouseenter":"click";e("body").on(t,".xoo-wsc-has-back",this.animate),e("body").on("mouseleave",".xoo-wsc-has-back",this.reverseAnimate)},animate:function(t){if(t.target.classList.contains("xoo-wsc-smr-del"))return;var s=e(this).find(".xoo-wsc-img-col");if(s.hasClass("xoo-wsc-caniming"))return;t.preventDefault(),s.attr("data-exclasses",s.attr("class")),s.removeClass(),s.addClass(s.attr("data-exclasses")),s.addClass("xoo-wsc-caniming "+n.type)},reverseAnimate:function(){var t=e(this).find(".xoo-wsc-img-col");if(!t.hasClass("xoo-wsc-caniming"))return;t.addClass(n.type+"Return"),n.clear=setTimeout(function(){t.removeClass().addClass(t.attr("data-exclasses"))},n.duration*1e3)}},xoo_wsc_params.cardAnimate.enable==="yes"&&n.init()})