(function(e){"use strict";var t=e.epoAPI.util.getStorage("localStorage"),s=window.confirm,n=function(t,n){return this.elements=e(t),this.last=[],this.current=[],this.enableEvents=!0,this.backup=[],this.options=e.extend({},e.fn.tcTabs.defaults,n),this.elements.length>0&&(this.init(),this)};n.prototype={constructor:n,set:function(t){this.options=e.extend({},this.options,t),this.init(!0)},addHeaderEvents:function(n,o,i,a,r,c,l,d,u){var m="",h=this;a.off("closetab.tmtabs").on("closetab.tmtabs",function(){var t=e(this),s=n.find(t.data("tab"));t.removeClass("closed open").addClass("closed"),t.find(".tm-arrow").removeClass(h.options.classdown+" "+h.options.classup).addClass(h.options.classdown),h.options.useclasstohide?s.addClass("tm-hide").removeClass("tm-show"):s.hide(),s.removeClass("tm-animated "+h.options.animationclass),e(window).trigger("tc-closetab.tmtabs",{header:t,tab:s})}),a.off("opentab.tmtabs").on("opentab.tmtabs",function(){var t=e(this),s=n.find(t.data("tab"));t.removeClass("closed open").addClass("open"),t.find(".tm-arrow").removeClass(h.options.classdown+" "+h.options.classup).addClass(h.options.classup),h.options.useclasstohide?s.removeClass("tm-hide").addClass("tm-show"):s.show(),s.removeClass("tm-animated "+h.options.animationclass).addClass("tm-animated "+h.options.animationclass),h.current[o]=t.data("tab"),e(window).trigger("tc-opentab.tmtabs",{header:t,tab:h.current[o],table:s}),h.scrollIntoView(n,t,u)}),(h.options.showonhover===!0||typeof h.options.showonhover=="function")&&(m=" mouseover"),a.off("keydown.tmtabs").on("keydown.tmtabs",function(t){var n,s=e(this);t.keyCode===13&&s.trigger("click.tmtabs"),t.keyCode===40&&(n=s.closest(".tm-box").next().find("."+h.options.header)),t.keyCode===38&&(n=s.closest(".tm-box").prev().find("."+h.options.header)),n&&n.length&&(s.trigger("blur"),n.trigger(" focus").trigger("click"),t.preventDefault())}),a.off("click.tmtabs").on("click.tmtabs"+m,function(s){var a=e(this);if(s.preventDefault(),s.type==="mouseover"&&typeof h.options.showonhover=="function"&&!h.options.showonhover.call())return;if(h.current[o]===a.data("tab")){e(window).trigger("tc-isopentab.tmtabs",{header:a,tab:h.current[o],table:n.find(h.current[o])});return}h.last[o]&&e(h.last[o]).trigger("closetab.tmtabs"),a.trigger("opentab.tmtabs"),h.last[o]=a,t&&t.setItem("tmadmintab-"+i,a.attr(h.options.dataopenattribute)),e(window).trigger("tc-tmtabs-clicked",{tc:i,options:h.options,header:a,tab:h.current[o],table:n.find(h.current[o])})}),this.options.deletebutton?(a.append(this.options.deletebuttonhtml),a.find("."+this.options.deleteheader).off("click.tmtabs").on("click.tmtabs",function(t){var i=e(this),o=i.closest(".tm-box"),a=o.find("."+h.options.header),m=n.find("."+a.attr(h.options.dataattribute));if(t.stopPropagation(),n.find("."+h.options.headers+" ."+h.options.header).length<2)return;if(h.options.deleteconfirm&&!s(window.TMEPOGLOBALADMINJS.i18n_builder_delete))return;typeof h.options.beforedeletetab=="function"&&h.options.beforedeletetab.call(n,i,m),m.remove(),a.is(".open")&&(o.next().find("."+h.options.header).is(".closed")?o.next().find("."+h.options.header).trigger("click.tmtabs"):o.prev().find("."+h.options.header).is(".closed")&&o.prev().find("."+h.options.header).trigger("click.tmtabs")),o.remove(),h.checkSize(r,c,l,d,u,!0),typeof h.options.afterdeletetab=="function"&&h.options.afterdeletetab.call(n)})):a.find("."+this.options.deleteheader).remove(),this.options.editbutton?(a.append(h.options.editbuttonhtml),a.find("."+h.options.editheader).off("click.tmtabs").on("click.tmtabs",function(t){var s,o;h.enableEvents&&typeof h.options.oneditbutton=="function"&&(t.stopPropagation(),s=e(this),o=n.find("."+s.closest(".tm-box").find("."+h.options.header).attr(h.options.dataattribute)),h.options.oneditbutton.call(n,s,o))})):a.find("."+this.options.editheader).remove()},initHeader:function(t,n,s,o,i,a,r,c){var l,d=0,u=n.attr("class");t=e(t),l="."+t.attr(this.options.dataattribute),t.data("tab",l),this.options.useclasstohide?n.find(l).addClass("tm-hide").removeClass("tm-show"):n.find(l).hide(),n.find(l).data("state","closed"),!d&&t.is(".open")?(t.removeClass("closed open").addClass("open").data("state","open"),t.find(".tm-arrow").removeClass(this.options.classdown+" "+this.options.classup).addClass(this.options.classup),this.options.useclasstohide?n.find(l).removeClass("tm-hide").addClass("tm-show"):n.find(l).show(),n.find(l).data("state","open"),d=1,this.current[s]=l,this.last[s]=t):t.removeClass("closed open").addClass("closed").data("state","closed"),this.addHeaderEvents(n,s,u,t,o,i,a,r,c)},checkSize:function(t,n,s,o,i,a){var r,c,l=[],d=n.parents().addBack().not(":visible");d.each(function(){var t=e(this),o=this.style.display,a=t.css("display"),i=this.style.visibility,r=t.css("visibility"),s=!1,n={styleDisplay:o,cssDisplay:a,styleVisibility:i,cssVisibility:r,display:null,visibility:null,element:t};o==="none"&&(this.style.display="",n.display=!0,t.css("display")==="none"&&(this.style.display="block"),s=!0),i==="hidden"&&(this.style.visibility="",n.visibility=!0,t.css("visibility")==="hidden"&&(this.style.visibility="visible"),s=!0),s&&l.push(n)}),c=Math.round(n.outerWidth()),n.is(".has-scroll-arrows")&&(n.removeClass(".has-scroll-arrows"),c=Math.round(t.outerWidth())),a&&(r=n.find("."+this.options.header+".open"),r.length&&r.removeClass("open"),i.scrollWidth=n[0].scrollWidth,r.length&&r.addClass("open")),i.scrollWidth>c?(o.addClass("scroll-arrow-show"),s.addClass("scroll-arrow-show"),n.addClass("has-scroll-arrows"),i.scrollWidth-c===n.scrollLeft()?o.addClass("scroll-arrow-disabled scroll-arrow-right-disabled"):o.removeClass("scroll-arrow-disabled scroll-arrow-right-disabled"),n.scrollLeft()===0?s.addClass("scroll-arrow-disabled scroll-arrow-left-disabled"):s.removeClass("scroll-arrow-disabled scroll-arrow-left-disabled")):(o.removeClass("scroll-arrow-show"),s.removeClass("scroll-arrow-show"),n[0].scrollLeft=0,n.removeClass("has-scroll-arrows")),l.forEach(function(e){e.display&&(e.element[0].style.display=e.styleDisplay),e.visibility&&(e.element[0].style.visibility=e.styleVisibility)})},scrollIntoView:function(e,t,n){var o=n.scrollPos,s=e.find("."+this.options.headers),i=s.width();s.is(".has-scroll-arrows")&&t&&typeof t!="undefined"&&t.position()&&typeof t.position()!="undefined"&&(t.position().left<0?(n.scrollPos=Math.max(o+t.position().left+1,0),s.animate({scrollLeft:n.scrollPos+1+"px"},this.options.scrollDuration)):t.position().left+t.outerWidth()>i&&(n.scrollPos=Math.min(o+(t.position().left+t.outerWidth()-i),s[0].scrollWidth-s.outerWidth()),s.animate({scrollLeft:n.scrollPos-1+"px"},this.options.scrollDuration)))},initElement:function(n,s,o,i){var r,c,l,d,u,f,p,a=this,b=n.attr("class"),g=n.find("."+this.options.headers+" ."+this.options.header),h=0,v="",m={};if(g.length===0)return;r=n.find("."+this.options.headers),r.wrap('<div class="'+this.options.headersWrap+'"></div>'),c=n.find("."+this.options.headersWrap),this.options.scroll&&(c.html('<div class="tc-scroll-left-arrow"></div>'+c.html()+'<div class="tc-scroll-right-arrow"></div>'),g=n.find("."+this.options.headers+" ."+this.options.header),r=n.find("."+this.options.headers),d=n.find(".tc-scroll-left-arrow"),l=n.find(".tc-scroll-right-arrow"),typeof e.fn.mousewheel=="function"&&r.mousewheel(function(e,t){l.css("display")!=="none"&&(this.scrollLeft-=t*30,o.scrollPos=this.scrollLeft,e.preventDefault())}),r.animate({scrollLeft:o.scrollPos+"px"},0),this.checkSize(c,r,d,l,o,!0),e(window).off("resize.tmtabs"+i).on("resize.tmtabs"+i,function(){a.checkSize(c,r,d,l,o,!0)}),n.off("refresh.tmtabs"+i).on("refresh.tmtabs"+i,function(){a.checkSize(c,r,d,l,o,!0)}),e(function(){a.checkSize(c,r,d,l,o,!0)}),l.off("mousedown.tmtabs mouseup.tmtabs mouseleave.tmtabs mouseover.tmtabs mouseout.tmtabs").on("mousedown.tmtabs",function(e){var t=function(){var e=r.scrollLeft();o.scrollPos=Math.min(e+a.options.scrollDistance,o.scrollWidth-r.outerWidth()),r.animate({scrollLeft:o.scrollPos+"px"},a.options.scrollDuration,function(){a.checkSize(c,r,d,l,o)})};e.stopPropagation(),t(),p=setInterval(function(){t()},a.options.scrollDuration)}).on("mouseup.tmtabs mouseleave.tmtabs",function(){clearInterval(p)}).on("mouseover.tmtabs",function(){e(this).addClass("scroll-arrow-over scroll-arrow-right-over")}).on("mouseout.tmtabs",function(){e(this).removeClass("scroll-arrow-over scroll-arrow-right-over")}),d.off("mousedown.tmtabs mouseup.tmtabs mouseleave.tmtabs mouseover.tmtabs mouseout.tmtabs").on("mousedown.tmtabs",function(e){var t=function(){var e=r.scrollLeft();o.scrollPos=Math.max(e-a.options.scrollDistance,0),r.animate({scrollLeft:o.scrollPos+"px"},a.options.scrollDuration,function(){a.checkSize(c,r,d,l,o)})};e.stopPropagation(),t(),p=setInterval(function(){t()},a.options.scrollDuration)}).on("mouseup.tmtabs mouseleave.tmtabs",function(){clearInterval(p)}).on("mouseover.tmtabs",function(){e(this).addClass("scroll-arrow-over scroll-arrow-left-over")}).on("mouseout.tmtabs",function(){e(this).removeClass("scroll-arrow-over scroll-arrow-left-over")})),window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){m[t]=n}),this.last[s]=!1,this.current[s]="",n.data("tm-has-tmtabs",1),g.each(function(e,t){a.initHeader(t,n,s,c,r,d,l,o)}),this.options.sortabletabs&&n.find("."+this.options.headers+":not(.section_elements ."+this.options.headers+",.tm-settings-wrap ."+this.options.headers+",.builder-element-wrap ."+this.options.headers+")").sortable({cursor:"move",items:".tm-box:not(.tm-add-box)",start:function(t,s){var o=n.find("."+s.item.closest(".tm-box").find("."+a.options.header).attr(a.options.dataattribute));h=s.item.index(),v=s.item.find("."+a.options.header).attr(a.options.dataopenattribute),f=e.tmEPOAdmin.find_index(!0,o.find(".bitem").first()),typeof a.options.beforemovetab=="function"&&a.options.beforemovetab.call(this,h,o,f),a.enableEvents=!1},stop:function(t,s){var i,c,l=n.find("."+s.item.closest(".tm-box").find("."+a.options.header).attr(a.options.dataattribute)),r=n.find("."+a.options.slide+"."+v),o=n.find("."+a.options.headers+" ."+a.options.header+"["+a.options.dataopenattribute+"='"+v+"']").parent().index();o!==h&&(c=n.find("."+a.options.slide).eq(o),i=r.tcClone(),i.find(".bitem").remove(),o>h?c.after(i):o<h&&c.before(i),r.find(".bitem").toArray().forEach(function(t){t=e(t),typeof a.options.beforemovebitem=="function"&&a.options.beforemovebitem.call(this,o,h,l,f,t),i.append(t),typeof a.options.aftermovebitem=="function"&&a.options.aftermovebitem.call(this,o,h,l,f,t)}),r.remove(),typeof a.options.aftermovetab=="function"&&a.options.aftermovetab.call(this,o,h,l,f)),a.enableEvents=!0},cancel:".tm-add-box",forcePlaceholderSize:!0,revert:200,placeholder:"tm-box pl",tolerance:"pointer"}),this.options.addbutton?(c.append(this.options.addbuttonhtml),n.addClass("has-add-button").find("."+this.options.addheader).off("click.tmtabs").on("click.tmtabs",function(e){var m=n.find("."+a.options.headers+" ."+a.options.header),u=m.last(),f=u.attr(a.options.dataattribute),p=n.find("."+f),t=u.tcClone().off("closetab.tmtabs opentab.tmtabs click.tmtabs"),i=p.tcClone().empty(),h=a.options.slide+m.length;e.preventDefault(),t.html('<span class="tab-text">'+(n.find("."+a.options.headers+" ."+a.options.header).length+1)+"</span>").removeClass("closed open").addClass("closed").data("tab","."+h).data("state","closed").attr(a.options.dataattribute,h),i.removeClass(f).addClass(h),a.options.useclasstohide?i.addClass("tm-hide").removeClass(".tm-show"):i.hide(),i.removeClass("tm-animated "+a.options.animationclass),u.closest(".tm-box").after(t),t.wrap('<div class="tm-box"></div>'),a.addHeaderEvents(n,s,b,t,c,r,d,l,o),p.after(i),a.options.scroll&&r.animate({scrollLeft:t.width()+"px"},a.options.scrollDuration,function(){a.checkSize(c,r,d,l,o,!0)}),typeof a.options.afteraddtab=="function"&&a.options.afteraddtab.call(this,t,i)})):c.find("."+this.options.addheader).remove(),this.options.selectedtab==="auto"?(t&&(u=t.getItem("tmadmintab-"+b)),m.selected_tab!==void 0&&(u=m.selected_tab),m.menu!==void 0&&(u=m.menu),(u==null)&&(u=n.find("."+this.options.header).eq(0).attr(this.options.dataopenattribute)),n.find("."+this.options.header+"["+this.options.dataopenattribute+'="'+u+'"]').is(":visible")?n.find("."+this.options.header+"["+this.options.dataopenattribute+'="'+u+'"]').trigger("click.tmtabs"):n.find("."+this.options.header).eq(0).trigger("click.tmtabs")):this.options.selectedtab!==!1&&(u=parseInt(this.options.selectedtab,10),n.find("."+this.options.header+":eq("+u+")").trigger("click.tmtabs"))},init:function(t){var n=this;this.elements.each(function(s){var a,o=e(this),i={},r=o.html();!t&&n.backup[s]?o.html(n.backup[s]):n.backup[s]=r,i.scrollPos=0,i.scrollWidth=0,a=o.css("display"),o.show(),n.initElement(o,s,i,e.epoAPI.math.uniqueid("")),o.css("display",a)})}},e.fn.tcTabs=function(t){var o,a,r,i=e(this),s=i.data("tctabs"),c=e.makeArray(arguments);return c.splice(0,1),typeof t=="object"?a=t:a={},s||(s=new n(this,a),i.data("tctabs",s)),typeof t=="string"&&(o=s[t].apply(s,c)),o===void 0?r=i:r=o,r},e.fn.tcTabs.defaults={headers:"tm-tab-headers",headersWrap:"tc-tab-headers-wrap",header:"tab-header",slide:"tc-tab-slide",classdown:"tcfa-angle-down",classup:"tcfa-angle-up",animationclass:"appear",dataattribute:"data-id",dataopenattribute:"data-id",selectedtab:"auto",showonhover:!1,useclasstohide:!0,sortabletabs:!0,addbutton:!1,addheader:"tm-add-tab",addbuttonhtml:'<div class="tm-add-tab"><span class="tmicon tcfa tcfa-plus"></span></div>',afteraddtab:null,beforemovetab:null,aftermovetab:null,beforemovebitem:null,aftermovebitem:null,deletebutton:!1,deletebuttonhtml:'<div class="tm-del-tab"><span class="tcfa tcfa-times"></span></div>',deleteheader:"tm-del-tab",deleteconfirm:!1,beforedeletetab:null,afterdeletetab:null,editbutton:!1,editbuttonhtml:'<span class="tm-edit-tab"><span class="tcfa tcfa-edit"></span></span>',editheader:"tm-edit-tab",oneditbutton:null,scroll:!0,scrollDistance:300,scrollDuration:300},e.fn.tcTabs.Constructor=n,e.fn.tmtabs=e.fn.tcTabs})(window.jQuery)