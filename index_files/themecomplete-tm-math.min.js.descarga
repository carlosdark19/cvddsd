(function(e){"use strict";var r=function(e){var t,n,s,i,o=[i,null,!1,0,"","0"];for(t=0,s=o.length;t<s;t++)if(e===o[t])return!0;if(typeof e=="object"){for(n in e)if(e.hasOwnProperty(n))return!1;return!0}return!1},i=function(e,t){return!(!t||t.constructor!==Array&&t.constructor!==Object)&&e in t},C=function(e){const t=!0,n=t?/^(function)?\s*[^(]*\(\s*([^)]*)\)/m:/^(function)\s*[^(]*\(\s*([^)]*)\)/m,s=/,/,o=/^\s*(_?)(.+?)\1\s*$/,i=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;return((e||"").toString().replace(i,"").match(n)||["","",""])[2].split(s).map(function(e){return e.replace(o,function(e,t,n){return n.split("=")[0].trim()})}).filter(String).length},_=function(e){return e.length},y=function(e){return/boolean|number|string/.test(typeof e)},a=function(e){return{}.toString.call(e).split(" ")[1].slice(0,-1).toLowerCase()},n=function(e,t){var n;return typeof e!="string"&&typeof e!="number"||isNaN(e)?t!==void 0?t:0:(n=parseFloat(e),isNaN(n)?t!==void 0?t:e:n)},l=function(e,t){return e===t?0:e>t?1:-1},v=function(e){return e=(e+"").replace(/[^01]/gi,""),parseInt(e,2)},x=function(e){return e<0&&(e=4294967295+e+1),parseInt(e,10).toString(2)},w=function(e){return e<0&&(e=4294967295+e+1),parseInt(e,10).toString(16)},m=function(e){return e<0&&(e=4294967295+e+1),parseInt(e,10).toString(8)},j=function(e){return e*.017453292519943295},f=function(e,t=0){var n=e>=0?1:-1;return t===0?Math.round(e):parseFloat((Math.round(e*Math.pow(10,t)+n*1e-4)/Math.pow(10,t)).toFixed(t))},p=function(e){return e=(e+"").replace(/[^a-f0-9]/gi,""),parseInt(e,16)},g=function(e){return e=(e+"").replace(/[^0-7]/gi,""),parseInt(e,8)},h=function(e,t){var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),n=n/e,e*Math.sqrt(1+n*n)||null},b={variables:{},on_var_not_found:void 0,on_var_validation:void 0,operators:{},functions:{},cache:{},construct:function(){return this.add_defaults(),this.set_division_by_zero_to_zero(),this},add_operator:function(e){return this.operators[e.operator]=e,this},evaluate:function(e,t=!0){return this.execute(e,t)},parse:function(e){var t,n,o,i,s=0;for(o of e)if(o==="("?s++:o===")"&&s--,s<0)return!1;return s===0&&(t=new c(e,this.operators),t=t.tokenize().build_reverse_polish_notation(),i=new d(this.functions,this.operators),n=i.calculate(t,this.variables,this.on_var_not_found,this),"number"===a(n)&&!isNaN(n)&&n)},execute:function(e,t=!0){var n,s,r,o=e;return i(o,this.cache)?n=this.cache[o]:(n=new c(e,this.operators),n=n.tokenize().build_reverse_polish_notation(),t&&(this.cache[o]=n)),r=new d(this.functions,this.operators),s=r.calculate(n,this.variables,this.on_var_not_found,this),("number"!==a(s)||isNaN(s))&&(s=0),s},add_function:function(e,t){return this.functions[e]=new O(e,t),this},get_vars:function(){return this.variables},get_var:function(e){return i(e,this.variables)?this.variables[e]:(this.on_var_not_found&&"function"==typeof this.on_var_not_found&&this.on_var_not_found(e),o.trigger("Variable ("+e+") not set","UnknownVariableError",0))},set_var:function(e,t){return this.on_var_validation&&"function"==typeof this.on_var_validation&&(t=this.on_var_validation(e,t)),this.variables[e]=t,this},var_exists:function(e){return i(e,this.variables)},set_vars:function(e,t=!0){var n=this;return t&&this.remove_vars(),e.forFach(function(e,t){n.set_var(t,e)}),this},set_var_not_found_handler:function(e){return this.on_var_not_found=e,this},set_var_validation_handler:function(e){return this.on_var_validation=e,this},remove_var:function(e){return delete this.variables[e],this},remove_vars:function(){return this.variables={},this.on_var_not_found=null,this},get_operators:function(){return this.operators},get_functions:function(){return this.functions},remove_operator:function(e){delete this.operators[e]},set_division_by_zero_to_zero:function(){return this.add_operator(new u("/",!1,180,function(e,t){return e=Number(e),t=Number(t),0==t?0:e/t})),this},get_cache:function(){return this.cache},clear_cache:function(){this.cache=[]},add_defaults:function(){var e=this,t=this.default_operators(),n=this.default_functions();return Object.keys(t).forEach(function(n){var s=t[n];e.add_operator(new u(n,s[2],s[1],s[0]))}),Object.keys(n).forEach(function(t){var s=n[t];e.add_function(t,s)}),this.on_var_validation=this.default_var_validation,this.variables=this.default_vars(),this},default_operators:function(){return{"+":[function(e,t){return e=n(e,0),t=n(t,0),e+t},170,!1],"-":[function(e,t){return e=n(e,0),t=n(t,0),e-t},170,!1],uPos:[function(e){return e=n(e,0),e},200,!1],uNeg:[function(e){return e=n(e,0),0-e},200,!1],"*":[function(e,t){return e=n(e,0),t=n(t,0),e*t},180,!1],"/":[function(e,t){return e=n(e,0),t=n(t,0),r(t)?o.trigger("Division By Zero","DivisionByZeroError",0):e/t},180,!1],"^":[function(e,t){return e=n(e,0),t=n(t,0),Math.pow(e,t)},220,!0],"%":[function(e,t){return e=n(e,0),t=n(t,0),e%t},180,!1],"&&":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e&&t?1:0},100,!1],"||":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e||t?1:0},90,!1],"==":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&t.isNumeric()?n(e)===n(t)?1:0:0===l(e,t)?1:0},140,!1],"!=":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&t.isNumeric()?n(e)!==n(t)?1:0:0!==l(e,t)?1:0},140,!1],">=":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e>=t?1:0},150,!1],">":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e>t?1:0},150,!1],"<=":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e<=t?1:0},150,!1],"<":[function(e,t){return e=String(e),t=String(t),e.isNumeric()&&(e=n(e,0)),t.isNumeric()&&(t=n(t,0)),e<t?1:0},150,!1]}},default_functions:function(){var t=this;return{abs:Math.abs,acos:Math.acos,acosh:Math.acosh,arcsin:Math.asin,arcctg:function(e){return Math.PI/2-Math.atan(e)},arccot:function(e){return Math.PI/2-Math.atan(e)},arccotan:function(e){return Math.PI/2-Math.atan(e)},arcsec:function(e){return Math.acos(1/e)},arccosec:function(e){return Math.asin(1/e)},arccsc:function(e){return Math.asin(1/e)},arccos:Math.acos,arctan:Math.atan,arctg:Math.atan,array:function(...e){return e},asin:Math.asin,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,atn:Math.atan,avg:function(t,...e){var s;return Array.isArray(t)&&0===t.length?o.trigger("Array must contain at least one element!","InvalidArgumentError",0):(e=[].concat.apply([],[t,...e]),s=e.reduce(function(e,t){return n(t,0)+n(e,0)}),s/e.length)},average:function(t,...e){var s;return Array.isArray(t)&&0===t.length?o.trigger("Array must contain at least one element!","InvalidArgumentError",0):(e=[].concat.apply([],[t,...e]),s=e.reduce(function(e,t){return n(t,0)+n(e,0)}),s/e.length)},bindec:v,ceil:Math.ceil,cos:Math.cos,cosec:function(e){return Math.sin(1/e)},csc:function(e){return Math.sin(1/e)},cosh:Math.cosh,ctg:function(e){return Math.cos(e)/Math.sin(e)},cot:function(e){return Math.cos(e)/Math.sin(e)},cotan:function(e){return Math.cos(e)/Math.sin(e)},cotg:function(e){return Math.cos(e)/Math.sin(e)},ctn:function(e){return Math.cos(e)/Math.sin(e)},decbin:x,dechex:w,decoct:m,deg2rad:j,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,int:Math.floor,fmod:function(e,t){return e%t},hexdec:p,hypot:h,if:function(e,n,s){var o;return 0===e||1===e||!0===e||!1===e?o=e:o=t.execute(e),o?t.execute(n):t.execute(s)},intdiv:function(e,t){return Math.trunc(Math.trunc(e)/Math.trunc(t))},ln:Math.log,lg:Math.log10,log:Math.log,log1p:Math.log1p,max:function(e,...s){var t;return Array.isArray(e)&&0===e.length?o.trigger("Array must contain at least one element!","InvalidArgumentError",0):(t=Array.isArray(e)?e:[e,...s],t=t.map(n),Math.max(...t))},min:function(e,...s){var t;return Array.isArray(e)&&0===e.length?o.trigger("Array must contain at least one element!","InvalidArgumentError",0):(t=Array.isArray(e)?e:[e,...s],t=t.map(n),Math.min(...t))},octdec:g,pi:function(){return Math.PI},pow:Math.pow,rad2deg:function(e){return e*57.29577951308232},round:f,sin:Math.sin,sinh:Math.sinh,sec:function(e){return 1/Math.cos(e)},sqrt:Math.sqrt,tan:Math.tan,tanh:Math.tanh,tn:Math.tan,tg:Math.tan,lookuptable:function(s,o){var i,a,c,l,u,h=0,d=0,m=e.TMEPOJS;if(m&&(u=e&&e.jQuery&&e.jQuery.epoAPI&&e.jQuery.epoAPI.util.parseJSON(m.lookupTables),u)){if(Array.isArray(o)&&(d=o[1],o=o[0]),r(o))return 0;r(d)&&(d=0),Array.isArray(s)?(a=String(s[0]),l=String(s[1])):(a=String(s),l=""),i=u[o],i&&(i=i[d],i&&(i=i.data,c=i[a],c===void 0&&a&&a!==void 0&&(a.isNumeric()&&n(a)===0?c=i[Object.keys(i)[0]]:a&&(a=t.find_lookup_table_index(a,i),c=i[a])),c!==void 0&&(l&&l!==void 0?l=t.find_lookup_table_index(l,c):l=Object.keys(c)[0],l==="max"?h=n(c[Object.keys(c)[Object.keys(c).length-1]]):h=n(c[l]))))}return h},concat:function(e,...n){var t;return Array.isArray(e)&&0===e.length?o.trigger("Array must contain at least one element!","InvalidArgumentError",0):(t=Array.isArray(e)?e:[e,...n],t.join(""))}}},find_lookup_table_index:function(e,t){var o,s=Object.keys(t),i=function(e){var t=e[e.length-1],n=e.every(function(e){return String(e).isNumeric()});return n||t==="max"};if(i(s)){if(e=String(e).isNumeric()?n(e):e,o=s.map(function(e){return String(e).isNumeric()?n(e):e}).reduce(function(t,n){if(n==="max"&&e>t)return n;if(t==="max"&&e>n)return t;if(t<n){if(e>t&&e<=n)return n}else return e>n&&e<=t||e>t||n==="max"?t:n;return e>n?n:t}),s=s.map(function(e){return String(e).isNumeric()?n(e):e}),e>Math.max(...s)||e<Math.min(...s))return!1}else o=e;return o},default_vars:function(){return{pi:3.141592653589793,e:2.718281828459045}},default_var_validation:function(e,t){return!y(t)&&!Array.isArray(t)&&void 0!==t?o.trigger("Variable ("+e+") type ("+a(t)+") is not scalar or array!",0):t}},c=function(e,n){var a={tokens:[],input:"",operators:{},number_buffer:"",string_buffer:"",allow_negative:!0,in_single_quoted_string:!1,in_double_quoted_string:!1,is_number:function(e){return e>="0"&&e<="9"},is_alpha:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e},is_dot:function(e){return"."===e},is_lp:function(e){return"("===e},is_rp:function(e){return")"===e},is_comma:function(e){return","===e},empty_number_buffer_as_literal:function(){this.number_buffer.length&&(this.tokens.push(s(t.LITERAL,this.number_buffer)),this.number_buffer="")},empty_str_buffer_as_variable:function(){""!==this.string_buffer&&(this.tokens.push(s(t.VARIABLE,this.string_buffer)),this.string_buffer="")},tokenize:function(){var n=!1,e=this,o=[];return this.tokens=[],this.input.toString().split("").forEach(function(o){switch(!0){case e.in_single_quoted_string:if("\\"===o){n?(e.string_buffer+="\\",n=!1):n=!0;break}if("'"===o){n?(e.string_buffer+="'",n=!1):(e.tokens.push(s(t.STRING,e.string_buffer)),e.in_single_quoted_string=!1,e.string_buffer="");break}n&&(e.string_buffer+="\\",n=!1),e.string_buffer+=o;break;case e.in_double_quoted_string:if("\\"===o){n?(e.string_buffer+="\\",n=!1):n=!0;break}if('"'===o){n?(e.string_buffer+='"',n=!1):(e.tokens.push(s(t.STRING,e.string_buffer)),e.in_double_quoted_string=!1,e.string_buffer="");break}n&&(e.string_buffer+="\\",n=!1),e.string_buffer+=o;break;case"["===o:e.tokens.push(s(t.FUNCTION,"array")),e.allow_negative=!0,e.tokens.push(s(t.LEFTPARENTHESIS,""));break;case" "===o||`
`===o||"\r"===o||"	"===o:break;case e.is_number(o):if(""!==e.string_buffer){e.string_buffer+=o;break}e.number_buffer+=o,e.allow_negative=!1;break;case"e"===o.toLowerCase():if(e.number_buffer.length&&-1!==e.number_buffer.indexOf(".")){e.number_buffer+="e",e.allow_negative=!1;break}case e.is_alpha(o):e.number_buffer.length&&(e.empty_number_buffer_as_literal(),e.tokens.push(s(t.OPERATOR,"*"))),e.allow_negative=!1,e.string_buffer+=o;break;case'"'===o:e.in_double_quoted_string=!0;break;case"'"===o:e.in_single_quoted_string=!0;break;case e.is_dot(o):e.number_buffer+=o,e.allow_negative=!1;break;case e.is_lp(o):""!==e.string_buffer?(e.tokens.push(s(t.FUNCTION,e.string_buffer)),e.string_buffer=""):e.number_buffer.length&&(e.empty_number_buffer_as_literal(),e.tokens.push(s(t.OPERATOR,"*"))),e.allow_negative=!0,e.tokens.push(s(t.LEFTPARENTHESIS,o));break;case e.is_rp(o)||"]"===o:e.empty_number_buffer_as_literal(),e.empty_str_buffer_as_variable(),e.allow_negative=!1,e.tokens.push(s(t.RIGHTPARENTHESIS,o));break;case e.is_comma(o):e.empty_number_buffer_as_literal(),e.empty_str_buffer_as_variable(),e.allow_negative=!0,e.tokens.push(s(t.PARAMSEPARATOR,o));break;default:if("-"===o||"+"===o){if(e.allow_negative){e.allow_negative=!1,e.tokens.push(s(t.OPERATOR,"-"===o?"uNeg":"uPos"));break}if(e.number_buffer&&"e"===e.number_buffer[e.number_buffer.length-1]){e.number_buffer+=o;break}}e.empty_number_buffer_as_literal(),e.empty_str_buffer_as_variable(),"$"!==o&&(e.tokens.length>0?t.OPERATOR===e.tokens[e.tokens.length-1].type?e.tokens[e.tokens.length-1].value+=o:e.tokens.push(s(t.OPERATOR,o)):e.tokens.push(s(t.OPERATOR,o))),e.allow_negative=!0}}),this.empty_number_buffer_as_literal(),this.empty_str_buffer_as_variable(),this.tokens.forEach(function(e,t){o[t]=e.type}),o.forEach(function(n,i){i>0&&"space"===n&&"variable"===o[i+1]&&"variable"===o[i-1]&&(e.tokens[i]=new s(t.LITERAL,0),e.tokens.splice(i+1,1),e.tokens.splice(i-1,1))}),this},build_reverse_polish_notation:function(){var r,c,l,d,n=[],e=[],s=[],a=this;try{this.tokens.forEach(function(u){switch(u.type){case t.LITERAL:case t.VARIABLE:case t.STRING:n.push(u),s.length>0&&0===s[s.length-1]&&s.push(s.pop()+1);break;case t.FUNCTION:s.length>0&&0===s[s.length-1]&&s.push(s.pop()+1),e.push(u),s.push(0);break;case t.LEFTPARENTHESIS:e.push(u);break;case t.PARAMSEPARATOR:for(;t.LEFTPARENTHESIS!==e[e.length-1].type;){if(0===e.length)return o.trigger("Incorrect Brackets","IncorrectBracketsError",n);n.push(e.pop())}s.push(s.pop()+1);break;case t.OPERATOR:if(!i(u.value,a.operators))return o.trigger(u.value,"UnknownOperatorError",n);for(l=a.operators[u.value];e.length>0&&t.OPERATOR===e[e.length-1].type;){if(!i(e[e.length-1].value,a.operators))return o.trigger(e[e.length-1].value,"UnknownOperatorError",n);if(d=a.operators[e[e.length-1].value],d.priority>=l.priority){n.push(e.pop());continue}break}e.push(u);break;case t.RIGHTPARENTHESIS:for(;!0;)try{if(r=e.pop(),t.LEFTPARENTHESIS===r.type)break;n.push(r)}catch{return o.trigger("Incorrect Brackets","IncorrectBracketsError",n)}e.length>0&&t.FUNCTION===e[e.length-1].type&&(c=e.pop(),c.param_count=s.pop(),n.push(c));break;case t.SPACE:}})}catch(e){return n=[],o.trigger(e,"Error",n)}for(;0!==e.length;){if(t.LEFTPARENTHESIS===e[e.length-1].type||t.RIGHTPARENTHESIS===e[e.length-1].type)return o.trigger("Incorrect Brackets","IncorrectBracketsError",n);if(t.SPACE===e[e.length-1].type){e.pop();continue}n.push(e.pop())}return n}};return a.input=e,a.operators=n,a},t={LITERAL:"literal",VARIABLE:"variable",OPERATOR:"operator",LEFTPARENTHESIS:"LP",RIGHTPARENTHESIS:"RP",FUNCTION:"function",PARAMSEPARATOR:"separator",STRING:"string",SPACE:"space"},s=function(e,n,s){var o={type:t.LITERAL,value:void 0,name:void 0,param_count:null};return o.type=e,o.value=n,o.name=s,o},u=function(e,n,i,r){var c={operator:"",is_right_assoc:!1,priority:0,function:null,places:0};return c.operator=e,c.is_right_assoc=n,c.priority=i,c.function=r,c.places=C(r),c.execute=function(e){var n,i,r=[];if(e.length<this.places)return e.splice(0,e.length),o.trigger("Incorrect Expression","IncorrectExpressionError",new s(t.LITERAL,0));for(i=0;i<this.places;i++)r.unshift(e.pop().value);return n=this.function.apply(null,r),"number"!==a(n)&&"string"!==a(n)&&(n=0),new s(t.LITERAL,n)},c},O=function(e,n){var i={name:"",function:void 0,required_param_count:void 0};return i.name=e,i.function=n,i.required_param_count=_(n),i.execute=function(e,n){var i,a,c,r=[];if(n<this.required_param_count&&(n=this.required_param_count),n<this.required_param_count)return e.splice(0,e.length),o.trigger(this.name,"IncorrectNumberOfFunctionParametersError",new s(t.LITERAL,0));if(n>0)for(c=0;c<n;c++)i=e.length?e.pop().value:0,null===i?(i="0",r.push(i)):r.unshift(i);return a=this.function.apply(null,r),(a===1/0||a===-(1/0))&&(a=0),s(t.LITERAL,a)},i},d=function(c,l){var d={functions:{},operators:{}};return d.functions=c,d.operators=l,d.calculate=function(c,l,d=null,u=!1){var h,f=this,m=[];if(r(c))return 0;try{c.forEach(function(e){var n,a;if(t.LITERAL===e.type||t.STRING===e.type)m.push(e);else if(t.VARIABLE===e.type)n=e.value,a=null,i(n,l)?a=l[n]:d&&"function"==typeof d?a=d(n):(a=n,u.variables[n]=a,l[n]=a),m.push(s(t.LITERAL,a,n));else if(t.FUNCTION===e.type){if(!i(e.value,f.functions)){if(u.add_function(e.value,function(){return 0}),f.functions=u.functions,!i(e.value,f.functions))return o.trigger(e.value,"UnknownFunctionError",0);o.trigger(e.value,"UnknownFunctionError",0)}m.push(f.functions[e.value].execute(m,e.param_count))}else if(t.OPERATOR===e.type){if(!i(e.value,f.operators))return o.trigger(e.value,"UnknownOperatorError",0);m.push(f.operators[e.value].execute(m))}})}catch(t){e.TMEPOJS&&e.TMEPOJS.WP_DEBUG&&e.console.log(t)}return h=m.pop(),h==null||!r(m)?o.trigger("Stack must be empty","IncorrectExpressionError",0):(!1===h.value&&(h.value=0),!0===h.value&&(h.value=1),"string"===a(h.value)&&h.value.isNumeric()&&(h.value=n(h.value)),h.value)},d},o={trigger:function(t,n="",s=!1){return e.TMEPOJS&&e.TMEPOJS.WP_DEBUG&&(e.console.log(n+`
`+t),e.console.trace()),e.TMEPOGLOBALADMINJS&&e.TMEPOGLOBALADMINJS.WP_DEBUG?t:s}};e.tcmexp=b.construct()})(window)