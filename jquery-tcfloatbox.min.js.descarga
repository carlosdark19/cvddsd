(function(e){"use strict";var t=function(t,n){return this.element=e(t),this.settings=e.extend({},e.fn.tcFloatBox.defaults,n),this.settings.type="<"+this.settings.type+">",this.top=0,this.left=0,this.ticking=!1,this.element.length===1&&(this.init(),this)};t.prototype={constructor:t,destroy:function(){var t=this.settings;return this.instance!==void 0&&(e.fn.tcFloatBox.instances.splice(this.instance,1),delete this.instance,t.hideelements&&e("embed, object, select").css({visibility:"visible"}),t._ovl&&(t._ovl.off(),t._ovl.remove(),delete t._ovl),e(t.floatboxID).remove(),this.element.removeData("tcfloatbox"),e(window).off("scroll.tcfloatbox"+this.instance),e(window).off("resize.tcfloatbox"+this.instance)),this},hide:function(){var t=this.settings;t.hideelements&&e("embed, object, select").css({visibility:"visible"}),t.showoverlay===!0&&t._ovl&&t._ovl.hide(),e(t.floatboxID).addClass("tc-closing").removeClass(t.animateIn).addClass(t.animateOut),e(t.floatboxID).animate({opacity:0},t.closefadeouttime,function(){e(t.floatboxID).hide(),e(t.floatboxID).removeClass("tc-closing").addClass("tc-closed")}),e(window).off("scroll.tcfloatbox"+this.instance),e(window).off("resize.tcfloatbox"+this.instance)},requestTick:function(){var e=this.settings;this.ticking||(e.refresh?setTimeout(this.requestAnimationFrame.bind(this),e.refresh):requestAnimationFrame(this.update),this.ticking=!0)},requestAnimationFrame:function(){requestAnimationFrame(this.update.bind(this))},update:function(){this.render(),this.ticking=!1},doit:function(){this.requestTick()},render:function(){var n,s,o,t=this.settings,i=e.epoAPI.dom.size();t.refresh==="fixed"?n={top:0,left:0}:n=e.epoAPI.dom.scroll(),s=parseInt(n.top+(i.visibleHeight-e(t.floatboxID).height())/2,10),o=parseInt(n.left+(i.visibleWidth-e(t.floatboxID).width())/2,10),s=parseInt((s-this.top)/t.fps,10),o=parseInt((o-this.left)/t.fps,10),this.top+=s,this.left+=o,e(t.floatboxID).css({top:this.top+"px",left:this.left+"px",opacity:1})},show:function(){var n,s,t=this.settings;this.element.length===1&&(this.instance===void 0&&this.init(),t.hideelements&&e("embed, object, select").css({visibility:"hidden"}),s=e.epoAPI.dom.size(),t.showoverlay===!0&&(t._ovl?t._ovl.show():(t._ovl=e('<div class="fl-overlay"></div>').css({zIndex:parseInt(t.zIndex,10)-1,opacity:t.overlayopacity}),t._ovl.appendTo("body"),t.ismodal||(t.cancelEvent||t.unique?t._ovl.on("click",this.applyCancelEvent.bind(this)):t._ovl.on("click",t.cancelfunc.bind(this))))),t.showfunc&&t.showfunc.call(),e(t.floatboxID).removeClass("tc-closing").addClass(t.animationBaseClass+" "+t.animateIn),t.refresh==="fixed"?(t.top!==!1?n=t.top:(n=parseInt((s.visibleHeight-e(t.floatboxID).height())/2,10),n=n+"px"),e(t.floatboxID).css({position:"fixed",top:n}),t.left!==!1&&e(t.floatboxID).css({left:t.left})):this.render())},applyCancelEvent:function(){var e=this.settings;e.cancelEvent===!0?this.destroy():typeof e.cancelEvent=="function"&&e.cancelEvent.call(this,this)},applyCancelEventFromKey:function(e){e.which===27&&this.applyCancelEvent()},applyUpdateEvent:function(){var e=this.settings;typeof e.updateEvent=="function"&&e.updateEvent.call(this,this)},applyUpdateEventFromKey:function(e){e.which===13&&this.applyUpdateEvent()},init:function(){var n,s,o,t=this.settings,i=0;this.element.length===1&&(e.fn.tcFloatBox.instances.length>0&&(t.zIndex=parseInt(e.fn.tcFloatBox.instances[e.fn.tcFloatBox.instances.length-1].zIndex,10)+100),this.instance=e.fn.tcFloatBox.instances.length,e.fn.tcFloatBox.instances.push(t),t.id=t.id+this.instance,t.floatboxID="#"+e.epoAPI.dom.id(t.id),this.hide(),s=e.epoAPI.dom.size(),o=e.epoAPI.dom.scroll(),e(t.type).attr("id",t.id).addClass(t.classname).html(t.data).appendTo(this.element),e(t.floatboxID).css({width:t.width,height:t.height}),t.minWidth&&e(t.floatboxID).css({"min-width":t.minWidth}),t.minHeight&&e(t.floatboxID).css({"min-height":t.minHeight}),n=parseInt(o.left+(s.visibleWidth-e(t.floatboxID).width())/2,10),e(t.floatboxID).css({top:i+"px",left:n+"px","z-index":t.zIndex}),this.top=i,this.left=n,this.cancelfunc=t.cancelfunc,t.cancelEvent&&t.cancelClass&&(e(t.floatboxID).find(t.cancelClass).on("click",this.applyCancelEvent.bind(this)),t.isconfirm&&e(document).off("keyup.escape-"+t.floatboxID).on("keyup.escape-"+t.floatboxID,this.applyCancelEventFromKey.bind(this))),t.updateEvent&&t.updateClass&&(e(t.floatboxID).find(t.updateClass).on("click",this.applyUpdateEvent.bind(this)),t.isconfirm&&e(document).off("keyup.enter-"+t.floatboxID).on("keyup.enter-"+t.floatboxID,this.applyUpdateEventFromKey.bind(this))),this.show(),t.refresh!=="fixed"&&e(window).on("scroll.tcfloatbox"+this.instance,this.doit.bind(this)),e(window).on("resize.tcfloatbox"+this.instance,this.doit.bind(this)))}},e.fn.tcFloatBox=function(n){var o,a,r,i=e(this),s=i.data("tcfloatbox");return typeof n=="object"?a=n:a={},s||(s=new t(this,a),i.data("tcfloatbox",s)),typeof n=="string"&&(o=s[n].apply(s,[])),o===void 0?r=i:r=o,r},e.fn.tcFloatBox.defaults={id:"flasho",classname:"flasho",type:"div",data:"",width:"500px",height:"auto",minWidth:0,minHeight:0,closefadeouttime:1e3,animationBaseClass:"tm-animated",animateIn:"fadein",animateOut:"fadeout",top:!1,left:!1,refresh:!1,fps:4,hideelements:!1,showoverlay:!0,zIndex:100100,ismodal:!1,cancelfunc:t.prototype.hide,showfunc:null,cancelEvent:!0,cancelClass:".floatbox-cancel",updateEvent:!1,updateClass:!1,unique:!0,overlayopacity:.5,isconfirm:!1},e.fn.tcFloatBox.instances=[],e.fn.tcFloatBox.Constructor=t,e.tcFloatBox=function(n){var o=e("body"),s=!1,i=o.map(function(){return e(this).data("tcfloatbox")||""}).get().some(function(e){return e===""});return i||n.unique?(s=new t(o,n),o.data("tcfloatbox",s)):(s=o.data("tcfloatbox"),s.init()),s}})(window.jQuery)